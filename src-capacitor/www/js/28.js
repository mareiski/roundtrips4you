(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[28],{d843:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.user?n("div",{staticClass:"user q-px-lg q-pb-md"},[n("q-tabs",{staticClass:"text-grey",staticStyle:{"padding-top":"40px"},attrs:{dense:"","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[n("q-tab",{attrs:{name:"settings",label:"Einstellungen"}}),n("q-tab",{attrs:{name:"publicProfile",label:"Öffentliches Profil"}})],1),n("q-separator"),n("q-tab-panels",{attrs:{"keep-alive":"",animated:""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[n("q-tab-panel",{attrs:{name:"publicProfile"}},[n("public-user-profile")],1),n("q-tab-panel",{attrs:{name:"settings"}},[n("h4",[e._v("Einstellungen")]),n("q-form",{staticClass:"q-gutter-md rounded-borders",attrs:{bordered:""},on:{submit:e.onSaveUserSettings}},[n("q-list",{staticClass:"rounded-borders",staticStyle:{padding:"10px","margin-bottom":"30px"},attrs:{bordered:""}},[n("q-input",{attrs:{outlined:"",rules:[function(t){return null!==t&&""!==t&&(e.user.displayName===t||e.uniqueUserName(t))||"Bitte wähle einen Benutzernamen"}],label:"Benutzername","lazy-rules":""},model:{value:e.UserDisplayName,callback:function(t){e.UserDisplayName=t},expression:"UserDisplayName"}}),e.companyProfile?n("q-input",{attrs:{outlined:"","clear-icon":"",rules:[function(t){return!t||e.urlReg.test(t)||"Bitte gib einen richtigen Link an"}],label:"Website","lazy-rules":""},model:{value:e.CompanyWebsite,callback:function(t){e.CompanyWebsite=t},expression:"CompanyWebsite"}}):e._e(),e.companyProfile?n("q-input",{attrs:{outlined:"",autogrow:"",label:"Unternehmensbeschreibung",rules:[function(e){return null!==e&&""!==e||"Bitte gib eine Beschreibung an"},function(e){return e.length>10&&e.length<160||"Bitte gib eine Beschreibung zwischen 10 und 160 Zeichen an"}]},scopedSlots:e._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"subject"}})]},proxy:!0}],null,!1,823822416),model:{value:e.companyDescription,callback:function(t){e.companyDescription=t},expression:"companyDescription"}}):e._e(),n("div",{staticClass:"flex"},[n("div",[n("div",{staticClass:"uploader",style:{backgroundImage:"url("+e.titleImgUrl+")"}},[n("q-btn",{attrs:{round:"",color:"primary",icon:"add"},on:{click:function(){return e.$refs.titleUpload.pickFiles()}}})],1),n("q-uploader",{ref:"titleUpload",staticStyle:{"max-width":"300px",display:"none"},attrs:{url:"",label:"Titelbild hochladen",accept:".jpg, image/*","hide-upload-btn":""},on:{added:function(t){return e.fileAdded(t)}}})],1)]),n("div",{staticClass:"row"},[n("q-btn",{staticClass:"q-mt-md",attrs:{type:"submit",loading:e.submitting,label:"Speichern",color:"primary","text-color":"white"},scopedSlots:e._u([{key:"loading",fn:function(){return[n("q-spinner")]},proxy:!0}],null,!1,3173242255)})],1)],1)],1),n("q-form",{staticClass:"q-gutter-md rounded-borders",attrs:{bordered:""},on:{submit:e.onSaveUserPass}},[n("q-list",{staticClass:"rounded-borders",attrs:{bordered:""}},[n("q-expansion-item",{staticClass:"add-item",attrs:{clickable:"","expand-separator":""},on:{click:function(t){e.addButtonActive=!e.addButtonActive}},scopedSlots:e._u([{key:"header",fn:function(){return[n("q-item-section",{staticStyle:{"align-items":"center"}},[n("span",[e._v("Passwort ändern")])])]},proxy:!0}],null,!1,1439800149),model:{value:e.addExpanded,callback:function(t){e.addExpanded=t},expression:"addExpanded"}},[n("div",{staticStyle:{padding:"10px"}},[n("q-input",{attrs:{outlined:"",type:e.isPwd?"password":"text",label:"neues Passwort",rules:[function(e){return null!==e&&""!==e||"Bitte gib dein neues Passwort ein"}]},scopedSlots:e._u([{key:"append",fn:function(){return[n("q-icon",{staticClass:"cursor-pointer",attrs:{name:e.isPwd?"visibility_off":"visibility"},on:{click:function(t){e.isPwd=!e.isPwd}}})]},proxy:!0}],null,!1,3635466494),model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),n("q-input",{attrs:{outlined:"",type:e.isPwdRepeat?"password":"text",label:"neues Passwort wiederholen",rules:[function(e){return null!==e&&""!==e||"Bitte wiederhole dein Passwort"},function(t){return t===e.password||"Die beiden Passwörter stimmen nicht überein"}]},scopedSlots:e._u([{key:"append",fn:function(){return[n("q-icon",{staticClass:"cursor-pointer",attrs:{name:e.isPwdRepeat?"visibility_off":"visibility"},on:{click:function(t){e.isPwdRepeat=!e.isPwdRepeat}}})]},proxy:!0}],null,!1,1612466441),model:{value:e.passwordRepeat,callback:function(t){e.passwordRepeat=t},expression:"passwordRepeat"}}),n("div",{staticClass:"row"},[n("q-btn",{staticClass:"q-mt-md",attrs:{type:"submit",loading:e.submitting,label:"Speichern",color:"primary","text-color":"white"},scopedSlots:e._u([{key:"loading",fn:function(){return[n("q-spinner")]},proxy:!0}],null,!1,3173242255)})],1)],1)])],1)],1),n("h4",[e._v("Danger Zone")]),n("q-list",{staticClass:"rounded-borders",staticStyle:{padding:"10px","border-color":"red"},attrs:{bordered:""}},[n("p",{staticStyle:{"font-size":"18px"}},[e._v("Dieses Konto und alle enthaltenen Inhalte löschen")]),n("q-btn",{staticClass:"q-mt-md",attrs:{loading:e.deleting,label:"Löschen",color:"primary","text-color":"white"},on:{click:function(t){e.deleteDialog=!0}},scopedSlots:e._u([{key:"loading",fn:function(){return[n("q-spinner")]},proxy:!0}],null,!1,3173242255)}),n("q-dialog",{attrs:{persistent:""},model:{value:e.deleteDialog,callback:function(t){e.deleteDialog=t},expression:"deleteDialog"}},[n("q-card",[n("q-card-section",{staticClass:"row items-center"},[n("span",{staticClass:"q-ml-sm"},[e._v("Willst du wirklich deinen Konto und alle deine Reisen löschen ? Dies kann nicht mehr rückgängig gemacht werden.")])]),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Abbrechen",color:"primary"}}),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Konto Löschen",color:"primary"},on:{click:function(t){return e.deleteAccount()}}})],1)],1)],1)],1)],1)],1)],1):e._e()},s=[],r=n("1261"),o={meta:{title:"Profil",meta:{robot:{name:"description",content:"Dein Profil auf roundtrips4you. Dein Reiseplaner mit Kartenfunktion, Städtevorschlag, Hotelsuche..."}}},name:"user",data(){return{UserDisplayName:"",UserEmail:"",submitting:!1,titleImgUrl:"",password:"",isPwd:!0,passwordRepeat:"",isPwdRepeat:!0,deleteDialog:!1,deleting:!1,urlReg:/^(http:\/\/|https:\/\/)/,CompanyWebsite:null,companyProfile:!1,companyDescription:null,tab:"settings",addExpanded:!1}},components:{PublicUserProfile:()=>n.e(1).then(n.bind(null,"1b01"))},computed:{user(){return this.$store.getters["user/user"]}},methods:{logOut(){r["a"].logout(this.$router,this.$store)},fileAdded:function(e){let t=e;this.upload(t[0]),this.$refs.titleUpload.reset()},upload(e){const t=this,n=r["c"].ref().child("Images/Users/"+r["a"].user().uid+"/TitleImg");n.put(e).then((function(e){t.$q.notify({color:"green-4",textColor:"white",icon:"check_circle",message:"Bild wurde erfolgreich hochgeladen"}),n.getDownloadURL().then((function(e){t.titleImgUrl=e,t.onSaveUserSettings()}))}))},onSaveUserSettings(){let e=r["a"].user();if(e.displayName===this.UserDisplayName||this.uniqueUserName(this.UserDisplayName)){let t=this;e.updateProfile({displayName:this.UserDisplayName,photoURL:this.titleImgUrl}).then((function(){t.updateDBEntry(e.uid),t.$q.notify({color:"green-4",textColor:"white",icon:"check_circle",message:"Einstellungen wurden erfolgreich gespeichert"})})).catch((function(e){console.log(e),t.$q.notify({color:"red-5",textColor:"white",icon:"error",message:"Es ist ein Fehler aufgetreten, bitte versuche es erneut"})}))}else this.$q.notify({color:"red-5",textColor:"white",icon:"error",message:"Bitte gib einen anderen Benutzernamen an"})},updateDBEntry(e){let t=this,n=r["b"].collection("User").where("UserUID","==",e).limit(1);n.get().then(e=>{e.forEach(e=>{r["b"].collection("User").doc(e.id).update({UserImage:t.titleImgUrl,UserName:t.UserDisplayName,website:t.CompanyWebsite,companyDescription:t.companyDescription})})})},onSaveUserPass(){let e=this;r["a"].user().updatePassword(this.password).then((function(){e.$q.notify({color:"green-4",textColor:"white",icon:"check_circle",message:"Passwort wurde erfolgreich geändert"})})).catch((function(t){console.log(t),"auth/requires-recent-login"===t.code?e.$q.notify({color:"red-5",textColor:"white",icon:"error",message:"Bitte melde dich erneut an, bevor du dein Passwort änderst"}):e.$q.notify({color:"red-5",textColor:"white",icon:"error",message:"Es ist ein Fehler aufgetreten, bitte versuche es erneut"})}))},uniqueUserName(e){return new Promise((t,n)=>{e=e.trim();let i=r["b"].collection("User").where("UserName","==",e).limit(1);i.get().then(e=>{t(0===e.size||"Dieser Name ist bereits vergeben")}).catch((function(e){console.log("Error "+e),t(null)}))})},deleteAccount(){let e=this;r["a"].user().delete().then((function(){e.$q.notify({color:"green-4",textColor:"white",icon:"check_circle",message:"Schade, dein Konto wurde gelöscht"}),e.$router.push("/")})).catch((function(t){console.log(t),"auth/requires-recent-login"===t.code?e.$q.notify({color:"red-5",textColor:"white",icon:"error",message:"Bitte melde dich erneut an, bevor du dein Konto löscht"}):e.$q.notify({color:"red-5",textColor:"white",icon:"error",message:"Es ist ein Fehler aufgetreten, dein Konto konnte nicht gelöscht werden"})}))}},created(){r["a"].authRef().onAuthStateChanged(e=>{this.UserDisplayName=r["a"].user().displayName,this.UserEmail=r["a"].user().email,this.titleImgUrl=r["a"].user().photoURL;let t=r["b"].collection("User").where("UserUID","==",r["a"].user().uid).limit(1);t.get().then(e=>{e.forEach(e=>{this.companyProfile=!!e.data().companyProfile,e.data().website&&(this.CompanyWebsite=e.data().website),e.data().companyDescription&&(this.companyDescription=e.data().companyDescription)})})})}},a=o,l=n("2877"),c=Object(l["a"])(a,i,s,!1,null,null,null);t["default"]=c.exports}}]);