(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[20],{"884a":function(e,t,r){"use strict";var i=r("ae79"),n=r.n(i);n.a},ae79:function(e,t,r){},c21a:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"q-px-lg"},[null!==e.user?r("div",{staticClass:"edit-btn-container",staticStyle:{position:"fixed","z-index":"1",right:"0",padding:"10px"}},[r("q-btn",{attrs:{round:"",color:"primary",icon:"visibility"},on:{click:function(t){return e.$router.push("/rundreise-ansehen/"+e.RTId)}}},[r("q-tooltip",[e._v("Reise ansehen")])],1)],1):e._e(),r("h3",{staticStyle:{"padding-top":"10px"}},[e._v("Einstellungen")]),r("q-form",{staticClass:"q-gutter-md rounded-borders",attrs:{bordered:""}},[r("h4",[e._v("Reise teilen")]),r("q-list",{staticClass:"rounded-borders",staticStyle:{padding:"10px"},attrs:{bordered:""}},[r("q-item-label",{staticStyle:{"padding-bottom":"5px"}},[e._v("Wenn deine Rundreise veröffentlicht ist kann sie jeder ansehen und kopieren.")]),r("q-toggle",{attrs:{label:"Rundreise veröffentlichen",icon:"share",disable:!e.user||!e.user.displayName},on:{input:e.onSaveRoundtrip},model:{value:e.roundtrip.Public,callback:function(t){e.$set(e.roundtrip,"Public",t)},expression:"roundtrip.Public"}},[e.user&&e.user.displayName?e._e():r("q-tooltip",[e._v("Bitte erstelle zuerst einen Benutzernamen")])],1),r("q-select",{staticClass:"input-item",attrs:{outlined:"",options:e.categoryOptions,label:"Kategorie","use-input":"",rules:[function(e){return null!==e&&""!==e||"Bitte wähle eine Kategorie"}]},on:{blur:e.onSaveRoundtrip},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"access_time"}})]},proxy:!0}]),model:{value:e.roundtrip.Category,callback:function(t){e.$set(e.roundtrip,"Category",t)},expression:"roundtrip.Category"}}),r("div",{staticClass:"flex",staticStyle:{"padding-bottom":"20px"}},[r("q-rating",{staticClass:"stars",staticStyle:{"margin-right":"10px"},attrs:{size:"15px",color:"gold",readonly:!isNaN(e.hotelRatingAvg())},on:{blur:e.onSaveRoundtrip},model:{value:e.roundtrip.Stars,callback:function(t){e.$set(e.roundtrip,"Stars",t)},expression:"roundtrip.Stars"}}),r("q-item-label",[e._v("Durchschittliche Hotelbewertung "+e._s(isNaN(e.hotelRatingAvg())?"":"(errechnet)"))])],1),r("q-input",{attrs:{outlined:"",autogrow:"",label:"Kurze Beschreibung",rules:[function(e){return null!==e&&""!==e||"Bitte gib eine Beschreibung an"},function(e){return e.length>10&&e.length<160||"Bitte gib eine Beschreibung zwischen 10 und 160 Zeichen an"}]},on:{blur:e.onSaveRoundtrip},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"subject"}})]},proxy:!0}]),model:{value:e.roundtrip.Description,callback:function(t){e.$set(e.roundtrip,"Description",t)},expression:"roundtrip.Description"}}),r("q-select",{staticClass:"input-item",attrs:{outlined:"",options:["zu Fuß","Fahrrad","Auto"],label:"Reisemittel","use-input":"",rules:[function(e){return null!==e&&""!==e||"Bitte wähle ein Reisemittel"}]},on:{input:function(t){return e.getGeneralProfile()},blur:e.onSaveRoundtrip},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"commute"}})]},proxy:!0}]),model:{value:e.roundtrip.Profile,callback:function(t){e.$set(e.roundtrip,"Profile",t)},expression:"roundtrip.Profile"}}),e._l(e.roundtrip.Highlights,(function(t,i){return r("div",{key:t},[r("q-input",{attrs:{label:"Highlight"+i+1,outlined:"",rules:[function(e){return null!==e&&""!==e||"Bitte gib ein Highlight an"}]},on:{blur:e.onSaveRoundtrip},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"star"}})]},proxy:!0}],null,!0),model:{value:e.roundtrip.Highlights[i],callback:function(t){e.$set(e.roundtrip.Highlights,i,t)},expression:"roundtrip.Highlights[index]"}})],1)})),r("q-input",{attrs:{label:"Pauschalpreis ohne Freizeitgestaltung",type:"number",outlined:"",rules:[function(e){return null!==e&&0!==e&&e>0||"Bitte gib einen Preis an"}]},on:{blur:e.onSaveRoundtrip},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"euro"}})]},proxy:!0}]),model:{value:e.roundtrip.Price,callback:function(t){e.$set(e.roundtrip,"Price",t)},expression:"roundtrip.Price"}}),r("q-item-label",{staticStyle:{"padding-bottom":"5px","margin-top":"10px"}},[e._v("Angebotszeitraum")]),r("q-toggle",{attrs:{label:"Ganzes Jahr",icon:"event"},on:{input:e.onSaveRoundtrip},model:{value:e.roundtrip.OfferWholeYear,callback:function(t){e.$set(e.roundtrip,"OfferWholeYear",t)},expression:"roundtrip.OfferWholeYear"}}),r("br"),r("br"),e.offerPeriod?r("q-date",{directives:[{name:"show",rawName:"v-show",value:!e.roundtrip.OfferWholeYear,expression:"!roundtrip.OfferWholeYear"}],ref:"OfferPeriodDate",attrs:{"today-btn":"",mask:"DD.MM.YYYY",range:""},on:{input:e.onSaveRoundtrip},model:{value:e.offerPeriod,callback:function(t){e.offerPeriod=t},expression:"offerPeriod"}}):e._e()],2),r("h4",[e._v("Persönliche Informationen")]),r("q-list",{staticClass:"rounded-borders",staticStyle:{padding:"10px"},attrs:{bordered:""}},[r("p",{staticStyle:{"margin-bottom":"15px"}},[e._v("Diese werden nur dir angezeigt und auch beim Veröffentlichen nicht berücksichtigt.")]),r("div",[r("q-input",{attrs:{label:"Zimmer",type:"number",rules:[function(e){return null!==e&&""!==e&&e>0||"Bitte gib eine Zimmeranzahl an"}],outlined:""},on:{blur:e.onSaveRoundtrip},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"house"}})]},proxy:!0}]),model:{value:e.roundtrip.Rooms,callback:function(t){e.$set(e.roundtrip,"Rooms",t)},expression:"roundtrip.Rooms"}}),r("q-input",{attrs:{label:"Erwachsene",type:"number",rules:[function(e){return null!==e&&""!==e&&e>0||"Bitte gib die Anzahl der Erwachsenen Reisenden an"},function(t){return t<=9*parseInt(e.roundtrip.Rooms)||"Bitte wähle mehr Zimmer"}],outlined:""},on:{blur:e.onSaveRoundtrip},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"group"}})]},proxy:!0}]),model:{value:e.roundtrip.Adults,callback:function(t){e.$set(e.roundtrip,"Adults",t)},expression:"roundtrip.Adults"}}),r("q-input",{attrs:{label:"Kinder",type:"number",rules:[function(e){return null!==e&&""!==e&&e>=0&&e<=20||"Bitte gib die Anzahl der Kinder auf der Reise an"}],outlined:""},on:{input:function(t){e.roundtrip.ChildrenAges.length=parseInt(e.roundtrip.Children)},blur:function(t){return e.onSaveRoundtrip()}},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"child_friendly"}})]},proxy:!0}]),model:{value:e.roundtrip.Children,callback:function(t){e.$set(e.roundtrip,"Children",t)},expression:"roundtrip.Children"}}),parseInt(e.roundtrip.Children)>0&&parseInt(e.roundtrip.Children)<=20?r("div",{staticClass:"flex"},e._l(parseInt(e.roundtrip.Children),(function(t){return r("q-input",{key:t,staticStyle:{"margin-right":"10px"},attrs:{label:"Alter Kind "+t,type:"number",rules:[function(e){return null!==e&&""!==e&&e>0||"Bitte gib das Alter des Kindes an"}],outlined:""},on:{blur:e.onSaveRoundtrip},scopedSlots:e._u([{key:"prepend",fn:function(){return[r("q-icon",{attrs:{name:"child_friendly"}})]},proxy:!0}],null,!0),model:{value:e.roundtrip.ChildrenAges[t-1],callback:function(r){e.$set(e.roundtrip.ChildrenAges,t-1,r)},expression:"roundtrip.ChildrenAges[childNum - 1]"}})})),1):e._e()],1)]),r("h4",[e._v("An-/Abreise")]),e.roundtrip.DepatureDate?r("ArrivalDeparture",{attrs:{currentRoundtrip:e.roundtrip},on:{updateArrivalDeparture:function(t){return e.updateArrivalDeparture(t)}}}):e._e(),r("h4",[e._v("Titelbild")]),r("div",[r("div",{staticClass:"uploader"},[e.titleImgUrl?r("q-img",{staticStyle:{height:"100%"},attrs:{src:e.titleImgUrl}}):e._e(),r("q-btn",{staticStyle:{position:"absolute"},attrs:{round:"",color:"primary",icon:"add",disable:e.titleUploadDisabled},on:{click:function(){return e.$refs.titleUpload.pickFiles()}}},[r("q-inner-loading",{staticStyle:{"border-radius":"50%"},attrs:{showing:e.titleUploadDisabled}},[r("q-spinner",{attrs:{size:"42px",color:"primary"}})],1)],1)],1),r("q-uploader",{ref:"titleUpload",staticStyle:{"max-width":"300px",display:"none"},attrs:{url:"",label:"Titelbild hochladen",accept:".jpg, image/*","hide-upload-btn":""},on:{added:function(t){return e.fileAdded(t,"title")}}})],1),r("p",[e._v("Bitte verwende nur Bilder die für die Wiederverwendung eindeutig gekennzeichnet sind.")])],1),e.companyProfile?r("h4",[e._v("Unternehmenseinstellungen")]):e._e(),e.companyProfile?r("q-list",{staticClass:"rounded-borders",staticStyle:{padding:"10px"},attrs:{bordered:""}},[r("q-input",{attrs:{outlined:"","clear-icon":"",rules:[function(t){return!t||e.urlReg.test(t)||"Bitte gib einen richtigen Link an"}],label:"Link zu dieser Reise","lazy-rules":""},on:{blur:function(t){e.tripWebsite&&e.urlReg.test(e.tripWebsite)&&e.saveData("tripWebsite",e.tripWebsite)}},model:{value:e.tripWebsite,callback:function(t){e.tripWebsite=t},expression:"tripWebsite"}})],1):e._e(),r("h4",[e._v("Danger Zone")]),r("q-list",{staticClass:"rounded-borders",staticStyle:{padding:"10px","border-color":"red","margin-bottom":"20px"},attrs:{bordered:""}},[r("p",{staticStyle:{"font-size":"18px"}},[e._v("Diese Rundreise und alle enthaltenen Inhalte löschen")]),r("q-btn",{staticClass:"q-mt-md",attrs:{loading:e.deleting,label:"Löschen",color:"primary","text-color":"white"},on:{click:function(t){e.deleteDialog=!0}},scopedSlots:e._u([{key:"loading",fn:function(){return[r("q-spinner")]},proxy:!0}])}),r("q-dialog",{attrs:{persistent:""},model:{value:e.deleteDialog,callback:function(t){e.deleteDialog=t},expression:"deleteDialog"}},[r("q-card",[r("q-card-section",{staticClass:"row items-center"},[r("span",{staticClass:"q-ml-sm"},[e._v("Willst du wirklich diese Rundreise und alle enthaltenen Inhalte löschen ? Dies kann nicht mehr rückgängig gemacht werden.")])]),r("q-card-actions",{attrs:{align:"right"}},[r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Rundreise Löschen",color:"primary"},on:{click:function(t){return e.deleteRoundtrip()}}}),r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Abbrechen",color:"primary"}})],1)],1)],1)],1)],1)},n=[],o=r("bd4c"),s=r("1261"),a=r("15c8"),l=r("bc3a"),u=r.n(l);let d=Date.now(),p=new Date(d);p.setDate(p.getDate()+1);let c,h=o["b"].formatDate(d,"DD.MM.YYYY"),f=o["b"].formatDate(p,"DD.MM.YYYY");var g={name:"RoundtripSettings",components:{ArrivalDeparture:()=>r.e(4).then(r.bind(null,"87c3"))},data(){return{roundtrip:{},stops:[],offerPeriod:{from:h,to:f},region:null,profile:null,inputProfile:null,RTId:null,OfferStartPeriod:h,OfferEndPeriod:h,categoryOptions:[],deleteDialog:!1,companyProfile:!1,tripWebsite:null,deleting:!1,visible:!1,titleUploadDisabled:!1,shareLink:null,shareCode:null,arrivalDepatureProfile:null,destination:null,travelClass:null,nonStop:null,originCode:null,origin:null,originOptions:[],destinationOptions:[],destinationCode:null,depatureDate:null,returnDate:null}},computed:{user(){return this.$store.getters["user/user"]},sharedMethods(){return a["a"]},titleImgUrl(){return this.$store.getters["images/getTitleImg"](this.RTId)}},methods:{copyShareLink(e){let t=document.querySelector("#"+e);t.setAttribute("type","text"),t.select();try{document.execCommand("copy"),a["a"].showSuccessNotification("Link wurde erfolgreich kopiert")}catch(r){a["a"].showErrorNotification("Oops da ist wohl was schiefgelaufen")}t.setAttribute("type","hidden"),window.getSelection().removeAllRanges()},fileAdded(e,t){a["a"].fileAdded(e,t,this,this.RTId)},deleteImage(e){this.$store.dispatch("images/deleteImage",{RTId:this.RTId,url:e})},hotelRatingAvg(){let e=0,t=0;return this.stops.forEach((r,i)=>{r.HotelName&&(e+=parseInt(r.HotelStars,10),t++)}),e/t},getGeneralProfile(){switch(this.inputProfile){case"zu Fuß":this.profile="walking";break;case"Fahrrad":this.profile="cycling";break;default:this.profile="driving";break}},getStops(e){let t=s["b"].collection("RoundtripDetails").where("RTId","==",e).orderBy("InitDate");t.get().then(e=>{e.forEach(e=>{let t=e.data();if("string"!==typeof t.InitDate){let e=new Date(1e3*t.InitDate.seconds);t.InitDate=o["b"].formatDate(e,"DD.MM.YYYY HH:mm")}t.DayDuration||(t.DayDuration=0),t.DocId=e.id,this.stops.push(t),this.stops.sort(this.compare),this.fetchAndSaveCountries()})})},updateRegion(e){null!==e&&(this.region=e)},updateArrivalDeparture(e){this.roundtrip.TransportProfile=e.transportProfile,this.roundtrip.Origin=e.origin,this.roundtrip.Destination=e.destination,this.roundtrip.DepatureDate=e.depatureDate,this.roundtrip.ReturnDate=e.returnDate,this.roundtrip.TravelClass=e.travelClass,this.roundtrip.NonStop=e.nonStop,this.onSaveRoundtrip()},onSaveRoundtrip(){let e=JSON.parse(JSON.stringify(this.roundtrip));if(e.DepatureDate&&"string"===typeof e.DepatureDate&&(e.DepatureDate=a["a"].getDateFromString(e.DepatureDate)),e.ReturnDate&&"string"===typeof e.ReturnDate&&(e.ReturnDate=a["a"].getDateFromString(e.ReturnDate)),this.offerPeriod&&this.offerPeriod.from&&"string"===typeof this.offerPeriod.from&&this.offerPeriod.to&&"string"===typeof this.offerPeriod.to){let t=a["a"].getDateFromString(this.offerPeriod.from),r=a["a"].getDateFromString(this.offerPeriod.to);e.OfferStartPeriod=t,e.OfferEndPeriod=r}s["b"].collection("Roundtrips").doc(this.RTId).update(e).catch(e=>{console.log(e),a["a"].showErrorNotification("Bitte überprüfe deine Angaben")})},fetchAndSaveCountries(){let e=[],t=[];this.stops.forEach(r=>{let i="http://api.geonames.org/countryCodeJSON?lang=de&lat="+r.Location.lat+"&lng="+r.Location.lng+"&username=roundtrips4you";t.push(u.a.get(i).then(t=>{e.includes(t.data.countryName)||e.push(t.data.countryName)}).catch((function(e){console.log(e)})))}),Promise.all(t).then(()=>{this.roundtrip.countries=e})},fetchCategories(){let e=s["b"].collection("Categories");e.get().then(e=>{this.categoryOptions=[],e.forEach(e=>{this.categoryOptions.push(e.data().Category)})})},fetchSingleRoundtrip(e){if(this.isInDemoSession){let e=this.$store.getters["demoSession/getRoundtrip"];this.writeRoundtripIntoFields(e)}else this.$store.dispatch("roundtrips/fetchSingleRoundtrip",e).then(e=>{this.writeRoundtripIntoFields(e)}).catch(e=>{console.log("Error getting Roundtrip",e),s["a"].user()&&a["a"].showErrorNotification("Es gibt fehlende Angaben bei deiner Rundreise")})},writeRoundtripIntoFields(e){if(this.shareLink="https://roundtrips4you.de/MapWidget/"+this.RTId,this.shareCode='<iframe src="https://roundtrips4you.de/MapWidget/'+this.RTId+'"></iframe>',this.roundtrip=e,this.roundtrip.Children=e.ChildrenAges.length,this.roundtrip.TransportProfile||(this.roundtrip.TransportProfile="Flugzeug"),this.pageTitle=this.roundtrip.Title+" bearbeiten",e.OfferStartPeriod&&e.OfferEndPeriod){let t=new Date(1e3*e.OfferEndPeriod.seconds),r=o["b"].formatDate(t,"DD.MM.YYYY");t=new Date(1e3*e.OfferStartPeriod.seconds);let i=o["b"].formatDate(t,"DD.MM.YYYY");this.offerPeriod.from=i,this.offerPeriod.to=r}else this.roundtrip.OfferWholeYear=!0;"Flugzeug"===this.arrivalDepatureProfile&&(this.roundtrip.travelClass||(this.roundtrip.travelClass="Economy"),this.roundtrip.nonStop||(this.roundtrip.nonStop="Ja")),this.getGeneralProfile(),this.$store.dispatch("images/loadAllImgs",this.RTId)},deleteRoundtrip(){if(null===this.RTId||""===this.RTId||"undefined"===this.RTId)return!1;try{this.$store.dispatch("roundtrips/deleteRoundtrip",this.RTId).then(e=>{e?(a["a"].showSuccessNotification("Rundreise wurde gelöscht"),c.$router.push("/meine-rundreisen")):a["a"].showErrorNotification("Die Rundreise konnte nicht gelöscht werden")})}catch(e){console.log(e),a["a"].showErrorNotification("Die Rundreise konnte nicht gelöscht werden")}}},created(){let e=this.$route.params.id;this.RTId=e,c=this,e?(this.getStops(e),this.fetchCategories(),this.fetchSingleRoundtrip(e)):(a["a"].showErrorNotification("Oops die Einstellungen konnten nicht geladen werden."),this.$router.push("/meine-rundreisen"))}},m=g,b=(r("884a"),r("2877")),y=Object(b["a"])(m,i,n,!1,null,null,null);t["default"]=y.exports}}]);